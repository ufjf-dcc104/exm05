<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Plataforma</title>
		<script src="Sprite.js"></script>
	</head>
	<body>
		<h1>Plataforma</h1>
		<canvas width="600" height="300">
			Seu navegador nao tem suporte ao canvas!
		</canvas>

<script>
	var tela = document.getElementsByTagName("canvas")[0];
	var ctx = tela.getContext("2d");
	var mapa = [];
	for (var l = 0; l < 10; l++) {
		mapa[l] = [];
		for (var c = 0; c < 20; c++){
			mapa[l][c] = 0;
			if(l==9 || c == 0 || c == 19) mapa[l][c] = 1;
			if(Math.random()<0.10){
				mapa[l][c] = 1;
			}
		}
	}

	var fps = 60;
	var g = 60;
	var dt = 1/fps;

	var pc = new Sprite();
	var inimigo = new Sprite();
	inimigo.x = 30*18;
	var bonus = new Sprite();
	bonus.x = 30*15;

	pc.controlar = function(){
		if(this.direita){
			this.ax = -150;
		}else if(this.esquerda){
			this.ax =  150;
		}else{
			this.ax = 0;
		}
		if(this.pulando && this.vy == 0){
			this.vy = -2*g;
			this.pulando = false;
		}
	};

	inimigo.controlar = function () {
		if(this.x>pc.x){
			this.ax = -100;
		}else if(this.x<pc.x){
			this.ax = 100;
		}
		if(this.y>pc.y && this.vy == 0){
			this.vy -= 2*g;
		}
			
	}
	bonus.controlar = function () {
		if(this.x>pc.x){
			this.ax = 100;
		}else if(this.x<pc.x){
			this.ax = -100;
		}
		if(this.y==pc.y && this.vy == 0){
			this.vy -= 2*g;
		}
			
	}
		
	addEventListener("keydown", function(e){
		if(e.keyCode==37){
			pc.direita = true;
		}
		if(e.keyCode==39){
			pc.esquerda = true;
		}
		if(e.keyCode==38){
			pc.pulando = true;
		}

	});
	addEventListener("keyup", function(e){
		if(e.keyCode==37){
			pc.direita = false;
		}
		if(e.keyCode==39){
			pc.esquerda = false;
		}
		if(e.keyCode==38){
			pc.pulando = false;
		}
		
	});

	setInterval(passo, 1000/fps);
	function passo(){

		ctx.fillStyle = "black";
		ctx.fillRect(0,0, tela.width, tela.height);	
		desenharMapa();
		pc.controlar();
		inimigo.controlar();
		bonus.controlar();
		inimigo.moverCartGrid(dt,200, mapa);
		pc.moverCartGrid(dt,200, mapa);
		bonus.moverCartGrid(dt,200, mapa);

		pc.desenhar(ctx);
		inimigo.desenhar(ctx);
		bonus.desenhar(ctx);

		if(pc.colidiuCom(inimigo)){
			pc.x = 30*1;
			pc.y = 30*1;
			pc.vy = 0;
			pc.vx = 0;
		}
		if(pc.colidiuCom(bonus)){
			bonus.x = 30*Math.random()*20+1;
			bonus.y = 30*1;
			bonus.vy = 0;
			bonus.vx = 0;
		}

	}

	function desenharMapa(){

		for (var l = 0; l < 10; l++) {
			for (var c = 0; c < 20; c++){
				if(mapa[l][c]==1){
					ctx.fillStyle = 'gray';
				}else{
					ctx.fillStyle = 'black';
				}
				ctx.fillRect(c*30, l*30, 30, 30);
				ctx.strokeStyle = "black";
				ctx.strokeRect(c*30, l*30, 30, 30);
			}
		}	
	}
	addEventListener("mousedown", clique);
	function clique(e){
		console.dir(e);
		var gcx = Math.floor(e.layerX/30);
		var gcy = Math.floor(e.layerY/30);
		mapa[gcy][gcx] = mapa[gcy][gcx]?0:1;
	}
</script>
</html>
